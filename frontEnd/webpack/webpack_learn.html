<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浅入浅出webpack | 任振飞的博客</title>
    <meta name="description" content="Just Do it">
    
    
    <link rel="preload" href="/vuepress-bolg/assets/css/0.styles.8fb03ca1.css" as="style"><link rel="preload" href="/vuepress-bolg/assets/js/app.ea6c41f1.js" as="script"><link rel="preload" href="/vuepress-bolg/assets/js/21.c7b2fdc7.js" as="script"><link rel="prefetch" href="/vuepress-bolg/assets/js/10.5938ca84.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/11.eebccd28.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/12.9049cd61.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/13.92bff893.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/14.36faef53.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/15.028284c5.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/16.4ac1473a.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/17.654aef9d.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/18.7aa81695.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/19.936cc10b.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/2.2a0d8cfe.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/20.5bbc223e.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/22.ec4d39b2.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/3.e60e7ae5.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/4.6e7778de.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/5.eff4ac38.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/6.67474d49.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/7.f048c0a0.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/8.9a8a1911.js"><link rel="prefetch" href="/vuepress-bolg/assets/js/9.3363a5e6.js">
    <link rel="stylesheet" href="/vuepress-bolg/assets/css/0.styles.8fb03ca1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-bolg/" class="home-link router-link-active"><!----> <span class="site-name">任振飞的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-bolg/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuepress-bolg/frontEnd/jsCommon/array.html" class="nav-link">js常用</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/html/html5_webWorker.html" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/css/css_commonUsed.html" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/javascript/closure.html" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/vue/vue_unkown.html" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html" class="nav-link router-link-exact-active router-link-active">webpack</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/npm/npm.html" class="nav-link">npm</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/git/git.html" class="nav-link">git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/node/node_question.html" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/express/express_middleWare.html" class="nav-link">express</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/koa/koa_learn.html" class="nav-link">koa</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/mongodb/mongodb_commonUsed.html" class="nav-link">mongodb</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/nginx/nginx_learn.html" class="nav-link">nginx</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/jsp/jsp_commonUsed.html" class="nav-link">jsp</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/renzhenfei666/vuepress-bolg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-bolg/" class="nav-link">首页</a></div><div class="nav-item"><a href="/vuepress-bolg/frontEnd/jsCommon/array.html" class="nav-link">js常用</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/html/html5_webWorker.html" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/css/css_commonUsed.html" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/javascript/closure.html" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/vue/vue_unkown.html" class="nav-link">vue</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html" class="nav-link router-link-exact-active router-link-active">webpack</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/npm/npm.html" class="nav-link">npm</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/frontEnd/git/git.html" class="nav-link">git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/node/node_question.html" class="nav-link">node</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/express/express_middleWare.html" class="nav-link">express</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/koa/koa_learn.html" class="nav-link">koa</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/mongodb/mongodb_commonUsed.html" class="nav-link">mongodb</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/nginx/nginx_learn.html" class="nav-link">nginx</a></li><li class="dropdown-item"><!----> <a href="/vuepress-bolg/backEnd/jsp/jsp_commonUsed.html" class="nav-link">jsp</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/renzhenfei666/vuepress-bolg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html" class="active sidebar-link">浅入浅出webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#一、核心概念" class="sidebar-link">一、核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#_1-entry" class="sidebar-link">1.Entry</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#_2-output" class="sidebar-link">2.Output</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#_3-loaders" class="sidebar-link">3.Loaders</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#_4-plugins" class="sidebar-link">4.Plugins</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#_5-mode" class="sidebar-link">5.Mode</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#二、基本配置" class="sidebar-link">二、基本配置</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#三、如何通过node脚本使用webpack？" class="sidebar-link">三、如何通过Node脚本使用webpack？</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#四、动态生成index-html和bundle-js" class="sidebar-link">四、动态生成index.html和bundle.js</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#五、清理-dist文件夹" class="sidebar-link">五、清理/dist文件夹</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#六、搭建开发环境" class="sidebar-link">六、搭建开发环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#（一）使用source-maps进行调试" class="sidebar-link">（一）使用source maps进行调试</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#（二）使用开发工具" class="sidebar-link">（二）使用开发工具</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#（三）热模块替换" class="sidebar-link">（三）热模块替换</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#七、搭建生产环境" class="sidebar-link">七、搭建生产环境</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#八、性能优化" class="sidebar-link">八、性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#treeshaking" class="sidebar-link">TreeShaking</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#tips" class="sidebar-link">Tips</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#九、通过webpack构建pwa应用" class="sidebar-link">九、通过webpack构建PWA应用</a></li><li class="sidebar-sub-header"><a href="/vuepress-bolg/frontEnd/webpack/webpack_learn.html#十、参考文章" class="sidebar-link">十、参考文章</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="浅入浅出webpack"><a href="#浅入浅出webpack" aria-hidden="true" class="header-anchor">#</a> 浅入浅出webpack</h1> <p>准备了挺久，一直想要好好深入了解一下Webpack，之前一直嫌弃Webpack麻烦，偏向于Parcel这种零配置的模块打包工具一些，但是实际上还是Webpack比较靠谱，并且Webpack功能更加强大。由于上一次学习Webpack的时候并没有了解过Node.js，所以很多时候真的感觉无能为力，连个<code>__dirname</code>都觉得好复杂，学习过Node.js之后再来学习Webpack，就会好理解很多，这一次算是比较深入的了解一下Webpack，争取以后能够脱离<code>create-react-app</code>或者<code>Vue-Cli</code>这种脚手架工具，或者自己也能够写一套脚本自动配置开发环境。</p> <p>由于写这篇笔记的时候，Webpack已经发行了最新的Webpack 4.0，所以这篇笔记就算是学习Webpack 4.0的笔记吧，笔者所用版本是<strong>webpack 4.8.3</strong>，另外使用Webpack 4.x的命令行需要安装单独的命令行工具，笔者所使用的Webpack命令行工具是<strong>webpack-cli 2.1.3</strong>，学习的时候可以按照这个要求部署开发环境。</p> <p>此外，在学习webpack之前，你最好对ES6、Node.js有一定的了解，最好使用过一个脚手架。</p> <h2 id="一、核心概念"><a href="#一、核心概念" aria-hidden="true" class="header-anchor">#</a> 一、核心概念</h2> <p>Webpack具有四个核心的概念，想要入门Webpack就得先好好了解这四个核心概念。它们分别是<code>Entry（入口）</code>、<code>Output（输出）</code>、<code>loader</code>和<code>Plugins（插件）</code>。接下来详细介绍这四个核心概念。</p> <h3 id="_1-entry"><a href="#_1-entry" aria-hidden="true" class="header-anchor">#</a> 1.Entry</h3> <p>Entry是Webpack的入口起点指示，它指示webpack应该从哪个模块开始着手，来作为其构建内部依赖图的开始。可以在配置文件（webpack.config.js）中配置entry属性来指定一个或多个入口点，<strong>默认为./src</strong>（webpack 4开始引入默认值）。</p> <p><strong>具体配置方法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>entry<span class="token punctuation">:</span> string <span class="token operator">|</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>前者一个单独的string是配置单独的入口文件，配置为后者（一个数组）时，是多文件入口。</p> <p>另外还可以<strong>通过对象语法进行配置</strong>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>entryChunkName<span class="token punctuation">]</span><span class="token punctuation">:</span> string <span class="token operator">|</span> Array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        app<span class="token punctuation">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
        vendors<span class="token punctuation">:</span> <span class="token string">'./vendors.js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>以上配置表示从app和vendors属性开始打包构建依赖树，这样做的好处在于分离自己开发的业务逻辑代码和第三方库的源码，因为第三方库安装后，源码基本就不再变化，这样分开打包有利于提升打包速度，减少了打包文件的个数，<code>Vue-Cli</code>采取的就是这种分开打包的模式。但是为了支持拆分代码更好的DllPlugin插件，以上语法可能会被抛弃。</p> <h3 id="_2-output"><a href="#_2-output" aria-hidden="true" class="header-anchor">#</a> 2.Output</h3> <p>Output属性告诉webpack在哪里输出它所创建的bundles，也可指定bundles的名称，<strong>默认位置为./dist</strong>。整个应用结构都会被编译到指定的输出文件夹中去，最基本的属性包括<code>filename</code>（文件名）和<code>path</code>（输出路径）。</p> <p>值得注意的是，即是你配置了多个入口文件，你也只能有一个输出点。</p> <p><strong>具体配置方法：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span> <span class="token string">'/home/proj/public/dist'</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>值得注意的是,<code>output.filename</code>必须是绝对路径，如果是一个相对路径，打包时webpack会抛出异常。</p> <p><strong>多个入口时，使用下面的语法输出多个bundle：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        app<span class="token punctuation">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
        vendors<span class="token punctuation">:</span> <span class="token string">'./src/vendors.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>以上配置将会输出打包后文件app.js和vendors.js到<code>__dirname + '/dist'</code>下。</p> <h3 id="_3-loaders"><a href="#_3-loaders" aria-hidden="true" class="header-anchor">#</a> 3.Loaders</h3> <p>loader可以理解为webpack的编译器，它使得webpack可以处理一些非JavaScript文件，比如png、csv、xml、css、json等各种类型的文件，使用合适的loader可以让JavaScript的import导入非JavaScript模块。JavaScript只认为JavaScript文件是模块，而webpack的设计思想即万物皆模块，为了使得webpack能够认识其他“模块”，所以需要loader这个“编译器”。</p> <p>webpack中配置loader有两个目标：</p> <ul><li>（1）test属性：标志有哪些后缀的文件应该被处理，是一个正则表达式。</li> <li>（2）use属性：指定test类型的文件应该使用哪个loader进行预处理。</li></ul> <p>比如webpack.config.js:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span>
    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token punctuation">:</span> <span class="token string">'css-loader'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>该配置文件指示了所有的css文件在<code>import</code>时都应该经过css-loader处理，经过css-loader处理后，可以在JavaScript模块中直接使用<code>import</code>语句导入css模块。但是使用<code>css-loader</code>的前提是先使用npm安装<code>css-loader</code>。</p> <p>此处需要注意的是定义loaders规则时，不是定义在对象的rules属性上，而是定义在module属性的rules属性中。</p> <p><strong>配置多个loader</strong>：</p> <p>有时候，导入一个模块可能要先使用多个loader进行预处理，这时就要对指定类型的文件配置多个loader进行预处理，配置多个loader，把use属性赋值为数组即可，webpack会按照数组中loader的先后顺序，使用对应的loader依次对模块文件进行预处理。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token punctuation">:</span> <span class="token string">'style-loader'</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>此外，还可以使用内联方式进行loader配置：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>import Styles from 'style-loader!css-loader?modules!./style.css'

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>但是这不是推荐的方法，请尽量使用<code>module.rules</code>进行配置。</p> <h3 id="_4-plugins"><a href="#_4-plugins" aria-hidden="true" class="header-anchor">#</a> 4.Plugins</h3> <p>loader用于转换非JavaScript类型的文件，而插件可以用于执行范围更广的任务，包括打包、优化、压缩、搭建服务器等等，功能十分强大。要是用一个插件，一般是先使用npm包管理器进行安装，然后在配置文件中引入，最后将其实例化后传递给plugins数组属性。</p> <p>插件是webpack的支柱功能，目前主要是解决loader无法实现的其他许多复杂功能，<strong>通过plugins属性使用插件：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>向plugins属性传递实例数组即可。</p> <h3 id="_5-mode"><a href="#_5-mode" aria-hidden="true" class="header-anchor">#</a> 5.Mode</h3> <p>模式（Mode）可以通过配置对象的<code>mode</code>属性进行配置，主要值为<code>production</code>或者<code>development</code>。两种模式的区别在于一个是为生产环境编译打包，一个是为了开发环境编译打包。生产环境模式下，webpack会自动对代码进行压缩等优化，省去了配置的麻烦。</p> <p>学习完以上基本概念之后，基本也就入门webpack了，因为webpack的强大就是建立在这些基本概念之上，利用webpack多样的loaders和plugins，可以实现强大的打包功能。</p> <h2 id="二、基本配置"><a href="#二、基本配置" aria-hidden="true" class="header-anchor">#</a> 二、基本配置</h2> <p>按照以下步骤实现webpack简单的打包功能：</p> <ul><li><p>（1）建立工程文件夹，位置和名称随意，并将cmd或者git bash的当前路径切换到工程文件夹。</p></li> <li><p>（2）安装webpack和webpack-cli到开发环境：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>  npm install webpack webpack-cli --save-dev

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>（3）在工程文件夹下建立以下文件和目录：</p> <ul><li>/src
<ul><li>index.js</li> <li>index.css</li></ul></li> <li>/dist
<ul><li>index.html</li></ul></li> <li>webpack.config.js</li></ul></li> <li><p>（4）安装<code>css-loader</code>：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>  npm install css-loader --save-dev

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>（5）配置<code>webpack.config.js</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
      mode<span class="token punctuation">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
      entry<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
      output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          path<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span><span class="token punctuation">,</span>
          filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                  test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                  use<span class="token punctuation">:</span> <span class="token string">'css-loader'</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>（6）在<code>index.html</code>中引入<code>bundle.js</code>：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token comment">&lt;!--index.html--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>utf-8<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello World!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>./bundle.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>（7）在<code>index.js</code>中添加：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Success!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>（8）在工程目录下，使用以下命令打包：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>  webpack

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查看输出结果，可以双击<code>/dist/index.html</code>查看有没有报错以及控制台的输出内容。</p></li></ul> <h2 id="三、如何通过node脚本使用webpack？"><a href="#三、如何通过node脚本使用webpack？" aria-hidden="true" class="header-anchor">#</a> 三、如何通过Node脚本使用webpack？</h2> <p>webpack提供Node API，方便我们在Node脚本中使用webpack。</p> <p>基本代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 引入webpack模块。</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 引入配置信息。</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过webpack函数直接传入config配置信息。</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 通过compiler对象的apply方法应用插件，也可在配置信息中配置插件。</span>
<span class="token function">compiler</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProgressPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用compiler对象的run方法运行webpack，开始打包。</span>
compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 回调中接收错误信息。</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 回调中接收打包成功的具体反馈信息。</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="四、动态生成index-html和bundle-js"><a href="#四、动态生成index-html和bundle-js" aria-hidden="true" class="header-anchor">#</a> 四、动态生成index.html和bundle.js</h2> <p>动态生成是啥？动态生成就是指在打包后的模块名称内插入hash值，使得每一次生成的模块具有不同的名称，而index.html之所以要动态生成是因为每次打包生成的模块名称不同，所以在HTML文件内引用时也要更改script标签，这样才能保证每次都能引用到正确的JavaScript文件。</p> <p><strong>为什么要添加hash值？</strong></p> <p>之所以要动态生态生成bundle文件，是为了防止浏览器缓存机制阻碍文件的更新，在每次修改代码之后，文件名中的hash都会发生改变，强制浏览器进行刷新，获取当前最新的文件。</p> <p><strong>如何添加hash到bundle文件中？</strong></p> <p>只需要在设置output时，在<code>output.filename</code>中添加<code>[hash]</code>到文件名中即可，比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        path<span class="token punctuation">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span><span class="token punctuation">,</span>
        filename<span class="token punctuation">:</span> <span class="token string">'[name].[hash].js'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>现在可以动态生成bundle文件了，那么如何动态添加bundle到HTML文件呢？</strong></p> <p>每次打包bundle文件之后，其名称都会发生更改，每次人为地修改对应的HTML文件以添加JavaScript文件引用实在是令人烦躁，这时需要使用到强大的webpack插件了，有一个叫<code>html-webpack-plugin</code>的插件，可以自动生成HTML文件。安装到开发环境：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>npm install html-webpack-plugin --save-dev

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>安装之后，在<code>webpack.config.js</code>中引入，并添加其实例到插件属性（plugins）中去：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// other configs ...</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// options配置</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这时就可以看到每次生成bundle文件之后，都会被动态生成对应的html文件。</p> <p>在上面的代码中还可以看到<code>HtmlWebpackPlugin</code>插件的构造函数还可以传递一个配置对象作为参数。比较有用的配置属性有<code>title</code>（指定HTML中title标签的内容，及网页标题）、<code>template</code>（指定模板HTML文件）等等，其他更多具体参考信息请访问：<a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fjantimon%2Fhtml-webpack-plugin%23options" target="_blank" rel="noopener noreferrer">Html-Webpack-Plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="五、清理-dist文件夹"><a href="#五、清理-dist文件夹" aria-hidden="true" class="header-anchor">#</a> 五、清理/dist文件夹</h2> <p>由于每次生成的JavaScript文件都不同名，所以新的文件不会覆盖旧的文件，而旧的文件一只会存在于<code>/dist</code>文件夹中，随着编译次数的增加，这个文件夹会越来越膨胀，所以应该想办法每次生成新的bundle文件之前清理<code>/dist</code>文件夹，以确保文件夹的干净整洁，有以下两个较好的处理办法：</p> <p><strong>如果你是Node脚本调用webpack打包：</strong></p> <p>如果通过Node API调用webpack进行打包，可以在打包之前直接使用Node的fs模块删除<code>/dist</code>文件夹中的所有文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">deleteFolderRecursive</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> curPath <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> file<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">lstatSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// recurse</span>
                <span class="token function">deleteFolderRecursive</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// delete file</span>
                fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>curPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">rmdirSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">deleteFolderRecursive</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/dist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>可以看到在调用<code>compiler.run</code>打包之前，先使用自定义的<code>deleteFolderRecursive</code>方法删除了<code>/dist</code>目录下的所有文件。</p> <p><strong>如果你使用webpack-cli进行打包</strong></p> <p>这时候就得通过webpack的插件完成这个任务了，用到的插件是<code>clean-webpack-plugin</code>。</p> <p>安装：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>npm install clean-webpack-plugin --save-dev

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后在<code>webpack.config.js</code>文件中添加插件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> CleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dist'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>之后再次打包，你会发现之前的打包文件全部被删除了。</p> <h2 id="六、搭建开发环境"><a href="#六、搭建开发环境" aria-hidden="true" class="header-anchor">#</a> 六、搭建开发环境</h2> <p>开发环境与生产环境存在许多的差异，生产环境更讲究生产效率，因此代码必须压缩、精简，必须去除一些生产环境并不需要用到的调试工具，只需要提高应用的效率和性能即可。开发环境更讲究调试、测试，为了方便开发，我们需要搭建一个合适的开发环境。</p> <h3 id="（一）使用source-maps进行调试"><a href="#（一）使用source-maps进行调试" aria-hidden="true" class="header-anchor">#</a> （一）使用source maps进行调试</h3> <p><strong>为何要使用source maps？</strong></p> <p>因为webpack对源代码进行打包后，会对源代码进行压缩、精简、甚至变量名替换，在浏览器中，无法对代码逐行打断点进行调试，所有需要使用source maps进行调试，它使得我们在浏览器中可以看到源代码，进而逐行打断点调试。</p> <p><strong>如何使用source maps？</strong></p> <p>在配置中添加<code>devtool</code>属性，赋值为<code>source-map</code>或者<code>inline-source-map</code>即可，后者报错信息更加具体，会指示源代码中的具体错误位置，而<code>source-map</code>选项无法指示到源代码中的具体位置。</p> <h3 id="（二）使用开发工具"><a href="#（二）使用开发工具" aria-hidden="true" class="header-anchor">#</a> （二）使用开发工具</h3> <p>每次写完代码保存之后还需要手动输入命令或启动Node脚本进行编译是一件令人不胜其烦的事情，选择一下工具可以简化开发过程中的工作：</p> <ul><li>启用watch模式</li> <li>使用webpack-dev-server</li> <li>使用webpack-dev-middleware</li></ul> <p><strong>（1）使用watch模式</strong></p> <p>在使用<code>webpack-cli</code>进行打包时，通过命令<code>webpack --watch</code>即可开启watch模式，进入watch模式之后，一旦依赖树中的某一个模块发生了变化，webpack就会重新进行编译。</p> <p><strong>（2）使用webpack-dev-server</strong></p> <p>使用过<code>create-react-app</code>或者<code>Vue-Cli</code>这种脚手架的童鞋都知道，通过命令<code>npm run start</code>即可建立一个本地服务器，并且webpack会自动打开浏览器打开你正在开发的页面，并且一旦你修改了文件，浏览器会自动进行刷新，基本做到了所见即所得的效果，比webpack的watch模式更加方便给力。</p> <p>使用方法：</p> <ul><li><p>① 安装webpack-dev-server：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>  npm install --save-dev webpack-dev-server

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>② 修改配置文件，添加devServer属性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// webpack.config.js</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
      devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          contentBase<span class="token punctuation">:</span> <span class="token string">'./dist'</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>③ 添加命令属性到<code>package.json</code>：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token comment">// package.json</span>
  <span class="token punctuation">{</span>
      <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --open&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>④ 运行命令</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>  npm run start

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以看到浏览器打开后的实际效果，尝试修改文件，查看浏览器是否实时更新。</p></li></ul> <p>此外还可以再devServer属性下指定更多的配置信息,比如开发服务器的端口、热更新模式、是否压缩等等，具体查询：<a href="https://link.juejin.im/?target=https%3A%2F%2Fwebpack.js.org%2Fconfiguration%2Fdev-server%2F%23devserver" target="_blank" rel="noopener noreferrer">Webpack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>通过Node API使用<code>webpack-dev-server</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> WebpackDevServer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../../../lib/Server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">Webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> devServerOptions <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> webpackConfig<span class="token punctuation">.</span>devServer<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    stats<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        colors<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackDevServer</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> devServerOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">,</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Starting server on http://localhost:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><strong>（3）使用webpack-dev-middleware</strong></p> <p><code>webpack-dev-middleware</code>是一个比<code>webpack-dev-server</code>更加基础的插件，<code>webpack-dev-server</code>也使用了这个插件，所以可以理解为<code>webpack-dev-middleware</code>的封装层次更低，使用起来更加复杂，但是低封装性意味着较高的自定义性，使用<code>webpack-dev-middleware</code>可以定义更多的设置来满足更多的开发需求，它基于express模块。</p> <p>这一块不做过多介绍，因为<code>webpack-dev-server</code>已经能够应付大多数开发场景，不用再设置更多的express属性了，想要详细了解的童鞋可以了解：<a href="https://link.juejin.im/?target=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fdevelopment%2F%23%E4%BD%BF%E7%94%A8-webpack-dev-server" target="_blank" rel="noopener noreferrer">使用 webpack-dev-middleware<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>（4）设置IDE</strong></p> <p>某些IDE具有安全写入功能，导致开发服务器运行时IDE无法保存文件，此时需要进行对应的设置。</p> <p>具体参考：<a href="https://link.juejin.im/?target=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fdevelopment%2F%23%E8%B0%83%E6%95%B4%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8" target="_blank" rel="noopener noreferrer">调整文本编辑器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="（三）热模块替换"><a href="#（三）热模块替换" aria-hidden="true" class="header-anchor">#</a> （三）热模块替换</h3> <p>热模块替换（Hot Module Replacement，HMR），代表在应用程序运行过程中替换、添加、删除模块，浏览器无需刷新页面即可呈现出相应的变化。</p> <p><strong>使用方法：</strong></p> <ul><li><p>（1）在devServer属性中添加hot属性并赋值为true：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// webpack.config.js</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
      devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          hot<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>（2）引入两个插件到webpack配置文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// webpack.config.js</span>
  <span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
      devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          hot<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>（3）在<strong>入口文件底部</strong>添加代码，使得在所有代码发生变化时，都能够通知webpack：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./print.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Accepting the updated intMe module!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">printMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <p>热模块替换比较难以掌控，容易报错，推荐在不同的开发配置下使用不同的loader简化HMR过程。具体参考：<a href="https://link.juejin.im/?target=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fhot-module-replacement%2F%23%E5%85%B6%E4%BB%96%E4%BB%A3%E7%A0%81%E5%92%8C%E6%A1%86%E6%9E%B6" target="_blank" rel="noopener noreferrer">其他代码和框架<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="七、搭建生产环境"><a href="#七、搭建生产环境" aria-hidden="true" class="header-anchor">#</a> 七、搭建生产环境</h2> <p>生产环境要求代码精简、性能优异，而开发要求开发快速、测试方便，代码不要求简洁，所以两种环境下webpack打包的目的也不相同，所以最好将两种环境下的配置文件分开来。对于分开的配置文件，在使用webpack时还是要对其中的配置信息进行整合，<code>webpack-merge</code>是一个不错的整合工具（Vue-Cli也有使用到）。</p> <p><strong>使用方法：</strong></p> <ul><li><p>（1）安装webpack-merge：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>  npm install webpack-merge --save-dev

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>（2）建立三个配置文件：</p> <ul><li>webpack.base.conf.js</li> <li>webpack.dev.conf.js</li> <li>webpack.prod.conf.js</li></ul> <p>其中，<code>webpack.base.conf.js</code>表示最基础的配置信息，开发环境和生产环境都需要设置的信息，比如<code>entry</code>、<code>output</code>、<code>module</code>等。在另外两个文件中配置一些对应环境下特有的信息，然后通过<code>webpack-merge</code>模块与<code>webpack.base.conf.js</code>整合。</p></li> <li><p>（3）添加npm scripts：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>  <span class="token comment">// package.json</span>
  <span class="token punctuation">{</span>
      <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-dev-server --open --config webpack.dev.conf.js&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config webpack.prod.conf.js&quot;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <p>此外，建议设置mode属性，因为生产环境下会自动开启代码压缩，免去了配置的麻烦。</p> <h2 id="八、性能优化"><a href="#八、性能优化" aria-hidden="true" class="header-anchor">#</a> 八、性能优化</h2> <h3 id="treeshaking"><a href="#treeshaking" aria-hidden="true" class="header-anchor">#</a> TreeShaking</h3> <p>TreeShaking表示移除JavaScript文件中的未使用到的代码，webpack 4增强了这一部分的功能。通过配置package.json的sideEffects属性，可以指定哪些文件可以移除多余代码。如果sideEffects设置为false，那么表示文件中的未使用代码可以放心移除，没有副作用。如果有些文件中的冗余代码不能被移除，那么可以设置sideEffects属性为一个数组，数组内容为文件的路径字符串。</p> <p>指定无副作用的文件之后，设置mode为&quot;production&quot;，再次构建代码，可以发现未使用到的代码已经被移除。</p> <h3 id="tips"><a href="#tips" aria-hidden="true" class="header-anchor">#</a> Tips</h3> <ul><li>在<code>module.rules</code>属性中，设置include属性以指定哪些文件需要被loader处理。</li> <li>只使用必要的loader。</li> <li>保持最新版本。</li> <li>减少项目文件数。</li></ul> <h2 id="九、通过webpack构建pwa应用"><a href="#九、通过webpack构建pwa应用" aria-hidden="true" class="header-anchor">#</a> 九、通过webpack构建PWA应用</h2> <p>渐进式网络应用程序(Progressive Web Application - PWA)，是一种可以提供类似于原生应用程序(native app)体验的网络应用程序(web app)，在离线(offline)时应用程序能够继续运行功能，这是通过 Service Workers 技术来实现的。PWA是最近几年比较火的概念，它的核心是由service worker技术实现的在客户浏览器与服务器之间搭建的一个代理服务器，在网络畅通时，客户浏览器会通过service worker访问服务器，并且缓存注册的文件；在网络断开时，浏览器会访问service worker这个代理服务器，使得在网络断开的情况下，页面还是能够访问，实现了类似原生应用的网站开发。<code>create-react-app</code>已经实现了PWA开发的配置。</p> <p>下面介绍如何通过webpack快速开发PWA。</p> <ul><li><p>（1）安装插件<code>workbox-webpack-plugin</code>：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>npm install workbox-webpack-plugin --save-dev

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>（2）在配置文件中引入该插件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// webpack.config.js</span>
  <span class="token keyword">const</span> WorkboxPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'workbox-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
      plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token keyword">new</span> <span class="token class-name">WorkboxPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              clientsClaim<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              skipWaiting<span class="token punctuation">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>（3）使用webpack进行编译，打包出service-worker.js</p></li> <li><p>（4）在入口文件底部注册service worker：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/service-worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">registration</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'SW registered: '</span><span class="token punctuation">,</span> registration<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">registrationError</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'SW registration failed: '</span><span class="token punctuation">,</span> registrationError<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>（5）打开页面，进行调试：</p> <div class="language-sh line-numbers-mode"><pre class="language-text"><code>  npm run start

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>（6）打开浏览器调试工具，查看控制台的输出，如果输出“SW registered: ... ...”，表示注册service worker成功，接下来可以断开网络，或者关闭服务器，再次刷新，可以看到页面仍然可以显示。</p></li></ul> <h2 id="十、参考文章"><a href="#十、参考文章" aria-hidden="true" class="header-anchor">#</a> 十、参考文章</h2> <ul><li><a href="https://link.juejin.im/?target=https%3A%2F%2Fwebpack.docschina.org%2F" target="_blank" rel="noopener noreferrer">webpack官方中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/vuepress-bolg/assets/js/app.ea6c41f1.js" defer></script><script src="/vuepress-bolg/assets/js/21.c7b2fdc7.js" defer></script>
  </body>
</html>
